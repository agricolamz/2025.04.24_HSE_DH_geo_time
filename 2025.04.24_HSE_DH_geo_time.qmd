---
title: Работа с гео-данными и временными данными
subtitle: Цифровая гуманитаристика 2024/2025
author: Г. А. Мороз
institute: Международная лаборатория языковой конвергенции, НИУ ВШЭ
date: 04/24/2025
date-format: D.MM.YYYY
format: 
  beamer:
    theme: Singapore
    mainfont: Brill
    monofont: Iosevka
    df-print: kable
    pdf-engine: xelatex
    classoption: t
    header-includes: |
       \setbeamertemplate{footline}[page number]
       \usepackage{caption}
       \captionsetup[figure]{labelformat=empty}
       \captionsetup[subfigure]{labelformat=empty}
       \setbeamercolor{alerted text}{fg=teal}
urlcolor: teal
execute:
  message: false
  warning: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false

# https://martinfleischmann.net/sds/

# setwd("/home/agricolamz/work/materials/2025.04.24_HSE_DH_geo_time")

library(knitr)
library(tidyverse)
library(sf)
library(maptiles)
library(tidyterra)
```

# Пространственные данные

## Анализ данных может включать

-   сбор данных
-   очистку данных и их предобработку
-   визуализацию данных
-   моделирование данных
-   дискриптивный анализ
-   предиктивный анализ
-   машинное обучение
-   ...

## Анализ пространственных данных --- это

анализ данных, который основывается на понятиях места, растояний и пространственного взаимодействия как ключевых признаков данных и использует особые инструменты и методы для хранения, визуализации и исследования такого типа данных.

## Пространственные примитивы

```{r}
#| out-width: 65%
#| fig-align: center

include_graphics("images/01_geometries.png")
```

## Какие пространственные примитивы можно здесь найти?

```{r}
#| out-width: 115%
#| fig-align: center

include_graphics("images/02_dagestan.png")
```

## Чего, как Вам кажется, здесь не хватает?

```{r}
#| out-width: 65%
#| fig-align: center

include_graphics("images/01_geometries.png")
```

\pause

Мне не хватает объема (т. е. учета высотности).

## Кладбище Стародуб (данные полевого архива [SFIRA](https://sfira.org/))

```{r}
read_csv("data/starodub.csv") |> 
  filter(!is.na(longitude)) |> 
  st_as_sf(coords = c("longitude", "latitude"),
           crs = "+proj=lonlat") |> 
  st_transform(3857) ->
  starodub

ggplot() +
  geom_sf(data = starodub) +
  coord_sf(crs = 3857)+
  theme_minimal()
```

## Кладбище Стародуб (данные полевого архива [SFIRA](https://sfira.org/))

```{r}
tile <- get_tiles(starodub, provider = "OpenStreetMap", zoom = 18)

ggplot() +
  geom_spatraster_rgb(data = tile, alpha = 0.5) +
  geom_sf(data = starodub) +
  coord_sf(crs = 3857)+
  theme(text = element_text(size = 17))+
  theme_minimal()
```

## Кладбище Стародуб (данные полевого архива [SFIRA](https://sfira.org/))

```{r}
ggplot() +
  geom_spatraster_rgb(data = tile, alpha = 0.5) +
  geom_sf(aes(colour = gender), data = starodub) +
  coord_sf(crs = 3857)+
  theme_minimal()+
  theme(text = element_text(size = 17))+
  scale_color_manual(values = c("#ebc106", "#396c03", "grey60")) +
  labs(color = NULL) 
```

## Кладбище Стародуб (данные полевого архива [SFIRA](https://sfira.org/))

```{r}
ggplot() +
  geom_spatraster_rgb(data = tile, alpha = 0.5) +
  geom_sf(aes(colour = gender), 
          data = starodub |> filter(gender != "unknown")) +
  coord_sf(crs = 3857)+
  theme_minimal()+
  theme(text = element_text(size = 17))+
  scale_color_manual(values = c("#ebc106", "#396c03")) +
  labs(color = NULL) 
```

## Кладбище Стародуб (данные полевого архива [SFIRA](https://sfira.org/))

```{r}
ggplot() +
  geom_spatraster_rgb(data = tile, alpha = 0.5) +
  geom_sf(aes(colour = year), 
          data = starodub |> 
            filter(!is.na(year))) +
  coord_sf(crs = 3857)+
  theme_minimal()+
  theme(text = element_text(size = 17))+
  scale_color_gradient(low = "darkblue", high = "tomato")+
  labs(color = NULL)+
  guides(alpha="none")
```

## Кладбище Стародуб (данные полевого архива [SFIRA](https://sfira.org/))

```{r}
ggplot() +
  geom_spatraster_rgb(data = tile, alpha = 0.5) +
  geom_sf(aes(colour = year, alpha = new_year), 
          data = starodub |> 
            filter(!is.na(year)) |> 
            mutate(new_year = 1 - (year-min(year, na.rm = TRUE))/(max(year, na.rm = TRUE)-min(year, na.rm = TRUE)))) +
  coord_sf(crs = 3857)+
  theme_minimal()+
  theme(text = element_text(size = 17))+
  scale_color_gradient(low = "darkblue", high = "tomato")+
  labs(color = NULL)+
  guides(alpha="none")
```

## Ошибка выжевшего: Абрахам Вальд

```{r}
#| out-width: 100%
#| fig-align: center

include_graphics("images/03_airplane.jpg")
```


## Географические проекции

-   [веб-приложение](https://projectionwizard.org/), помогающее выбрать подходящую проекцию
-   [веб-приложение](https://mathigon.org/course/circles/spheres-cones-cylinders#sphere-maps), которое показывает как изменяются объекты при преобразовании с сферы на 2d
-   [Здесь](https://proj.org/en/latest/operations/projections/all_images.html) есть список всех возможных проекций

## Динамические vs статические карты

## 

Мне хочется выразить благодарность Евгению Николаевичу Матерову за его блог и телеграм-канал "Наука и данные" (<https://t.me/naukaidannye>), которые значительно упростили написание этой лекции.

# Временные данные
